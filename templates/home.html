{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- CSS only (Bootstrap) -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
      crossorigin="anonymous"
    />
    <!--Leaflet's CSS -->
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
      integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI="
      crossorigin=""
    />
    <link rel="stylesheet" href="{% static 'css/styles.css' %}" />
    <title>GeoDimagi</title>
  </head>
  <body>
    <div id="map"></div>
    <a
      class="hamburger-btn"
      {%
      comment
      %}
      type="button"
      {%
      endcomment
      %}
      data-bs-toggle="offcanvas"
      data-bs-target="#offcanvasScrolling"
      aria-controls="offcanvasScrolling"
    >
      <img src="{% static 'images/hamburger-menu.png' %}" alt="" />
    </a>
    <div
      class="offcanvas offcanvas-start"
      data-bs-scroll="true"
      data-bs-backdrop="false"
      tabindex="-1"
      id="offcanvasScrolling"
      aria-labelledby="offcanvasScrollingLabel"
    >
      <div class="offcanvas-header">
        <h3 class="offcanvas-title" id="offcanvasScrollingLabel">
          Project Filtering
        </h3>
        <button
          type="button"
          class="btn-close text-reset"
          data-bs-dismiss="offcanvas"
          aria-label="Close"
        ></button>
      </div>
      <div class="offcanvas-body">
        <h2>Divisions:</h2>
        <form action="" class="division-form">
          <div class="form-check">
            <input
              name="divisioncheckboxes"
              class="form-check-input"
              type="checkbox"
              value="SaaS"
              checked
            />
            <label class="form-check-label" for="flexCheckChecked">
              SaaS
            </label>
          </div>
          <div class="form-check">
            <input
              name="divisioncheckboxes"
              class="form-check-input"
              type="checkbox"
              value="Solutions"
              checked
            />
            <label class="form-check-label" for="flexCheckChecked">
              Solutions
            </label>
          </div>
          <div class="form-check">
            <input
              name="divisioncheckboxes"
              class="form-check-input"
              type="checkbox"
              value="India"
              checked
            />
            <label class="form-check-label" for="flexCheckChecked">
              India
            </label>
          </div>
          <div class="form-check">
            <input
              name="divisioncheckboxes"
              class="form-check-input"
              type="checkbox"
              value="US Health"
              checked
            />
            <label class="form-check-label" for="flexCheckChecked">
              US Health
            </label>
          </div>
          <div class="form-check">
            <input
              name="divisioncheckboxes"
              class="form-check-input"
              type="checkbox"
              value="GSO"
              checked
            />
            <label class="form-check-label" for="flexCheckChecked"> GSO </label>
          </div>
        </form>
      </div>
    </div>

    <!--Leaflet's Javascript -->
    <script
      src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"
      integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM="
      crossorigin=""
    ></script>
    <!-- JavaScript Bundle with Popper (Bootstrap) -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
      crossorigin="anonymous"
    ></script>

    {% comment %}
    <script src="{% static 'js/index.js' %}">
      const default_coords = '{{ dimagi_cambridge_office_coords |escapejs}}';
    </script>
    {% endcomment %}
    <script>
      const DIMAGI_CAMBRIDGE_OFFICE_COORDS = JSON.parse(
        '{{ dimagi_cambridge_office_coords |escapejs }}'
      );
      {% comment %} let projects = {{ project }} {% endcomment %}
      {% comment %} console.log({) {% endcomment %}
      const DEFAULT_ZOOM = 13;

      const map = L.map('map').setView(
          [
            DIMAGI_CAMBRIDGE_OFFICE_COORDS.lat,
            DIMAGI_CAMBRIDGE_OFFICE_COORDS.long,
          ],
          DEFAULT_ZOOM
        );
      let project_array = []


      const loadPage = async() => {
        //Load the map


        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution:
            '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
        }).addTo(map);

        //Load the default markers
        //This is done asyncally, which might be a problem if the user uses the filters too quick
        {% comment %} {% for project in projects %}
         {% for location in project.location.all  %}
         console.log({{ location.location.x }},{{ location.location.y }})
          await project_array.push(L.marker([{{ location.location.x }}, {{ location.location.y }}]).addTo(map).bindPopup('{{ project.name }}'))

          {% endfor %}
        {% endfor %} {% endcomment %}


      };

      const groupie = L.featureGroup(project_array).addTo(map);



      const handleDivisionChange = (e) => {
        const checked_inputs = document.querySelectorAll('input[name=divisioncheckboxes]:checked')

        console.log(checked_inputs)
        var res = Array.from(checked_inputs).map(c => c.value).join(', ');
        console.log(res);

      }
      const division_form = document.querySelector('.division-form')
      division_form.addEventListener('change', e => handleDivisionChange(e) )




      loadPage();
    </script>
  </body>
</html>
